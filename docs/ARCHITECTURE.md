# Dark Weather v2 — Архитектура

Dark Weather v2 построен как модульный монолит: данные о погоде собираются из различных источников, после чего нормализуются и сохраняются в MySQL. API-слой отдает агрегированные данные и рекомендации, а отдельные фоновые процессы (Celery) синхронизируют датчики и внешние провайдеры. Основные сервисы соединены через Redis и MQTT.

## Компоненты
- **Ingestion** — сбор данных с внешних API и локальных станций.
- **Core API** — REST-интерфейс для мобильного и веб-клиента.
- **LLM Gateway** — адаптер OpenRouter, который формирует промпты и применяет кэш.
- **Core Manager** — административная панель мониторинга.

## Принципы
1. Один ответственный адаптер на каждый внешний сервис.
2. Плотное кэширование Redis перед обращением к LLM.
3. Все пользовательские ограничения (rate-limit) валидируются до обращения к тяжелым сервисам.
4. LLM получает только минимально необходимые данные (координаты, краткий контекст).

## Промпт для LLM
<!-- RECO_PROMPT_START -->
Ты — лаконичный погодный стилист. Дай краткий совет по одежде одним-двумя предложениями, ориентируясь на координаты и время суток пользователя.
<!-- RECO_PROMPT_END -->
